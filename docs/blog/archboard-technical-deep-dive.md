# ArchBoardï¼šè®©è„‘å­é‡Œçš„æƒ³æ³•ï¼Œç§’å˜æµç¨‹å›¾

> ä¸€ä¸ªç”¨ AI å¸®ä½ ç†æ¸…æ€è·¯çš„å¯è§†åŒ–å·¥å…· - ä¸æ˜¯ç”»å›¾è½¯ä»¶ï¼Œæ˜¯æ€ç»´æ•´ç†åŠ©æ‰‹

![ArchBoard](https://img.shields.io/badge/version-0.5.0-blue) ![License](https://img.shields.io/badge/license-MIT-green) ![Stars](https://img.shields.io/github/stars/yourusername/ArchBoard)

---

## ğŸŒŸ å†™åœ¨å‰é¢

è¿™ä¸ªé¡¹ç›®çš„åˆè¡·å¾ˆç®€å•ï¼š

**ä½œä¸ºæŠ€æœ¯äººï¼Œæˆ‘ç»å¸¸æœ‰è¿™æ ·çš„å›°æ‰°ï¼š**
- ğŸ’­ è„‘å­é‡Œæœ‰ä¸ªæŠ€æœ¯æ–¹æ¡ˆï¼Œä½†è¯´ä¸æ¸…æ¥š
- ğŸŒ€ ä¸šåŠ¡æµç¨‹å¤ªå¤æ‚ï¼Œè‡ªå·±éƒ½ç†ä¸æ¸…
- ğŸ¤¯ å¼€ä¼šè®¨è®ºæ—¶ï¼Œå¤§å®¶ç†è§£ä¸ä¸€è‡´
- ğŸ“ è®°äº†ä¸€å †ç¬”è®°ï¼Œäº‹åçœ‹ä¸æ‡‚

**æˆ‘éœ€è¦çš„ä¸æ˜¯ä¸€ä¸ª"ç”»å›¾å·¥å…·"ï¼Œè€Œæ˜¯ä¸€ä¸ª"æ€ç»´æ•´ç†åŠ©æ‰‹"ã€‚**

äºæ˜¯æˆ‘åšäº† **ArchBoard**ï¼š
> ç”¨è‡ªç„¶è¯­è¨€æè¿°ä½ çš„æƒ³æ³• â†’ AI è‡ªåŠ¨ç”Ÿæˆæµç¨‹å›¾ â†’ è¾¹çœ‹è¾¹è°ƒæ•´ â†’ æ€è·¯è¶Šæ¥è¶Šæ¸…æ™°

**æ ¸å¿ƒç†å¿µ**ï¼šä¸æ˜¯"ç”»å¾—å¥½ä¸å¥½çœ‹"ï¼Œè€Œæ˜¯**"æƒ³å¾—æ¸…ä¸æ¸…æ¥š"**ã€‚

---

## ğŸ¯ çœŸå®åœºæ™¯ï¼šè¿™ä¸ªå·¥å…·æ€ä¹ˆå¸®ä½ ç†æ¸…æ€è·¯ï¼Ÿ

### åœºæ™¯ 1ï¼šäº§å“ç»ç†ç†æ¸…ä¸šåŠ¡æµç¨‹

**ä¼ ç»Ÿåšæ³•çš„ç—›ç‚¹ï¼š**
- æ‰“å¼€ Axure/å¢¨åˆ€ï¼Œçº ç»“ç”¨ä»€ä¹ˆå½¢çŠ¶ï¼Œä»€ä¹ˆè¿çº¿
- ç”»äº†åŠå¤©ï¼Œå‘ç°æµç¨‹ä¸å¯¹ï¼Œåˆè¦é‡æ–°ç”»
- èŠ± 2 å°æ—¶ç”»å›¾ï¼Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘è¿˜æ²¡æƒ³æ¸…æ¥š

**ç”¨ ArchBoard çš„ä½“éªŒï¼š**

```
ä½ : "è®¾è®¡ä¸€ä¸ªç”µå•†ç§’æ€æµç¨‹ï¼Œç”¨æˆ·ç‚¹å‡»ç§’æ€æŒ‰é’®..."

AI: [3ç§’ç”ŸæˆåŸºç¡€æµç¨‹]
    ç”¨æˆ·ç‚¹å‡» â†’ æ£€æŸ¥åº“å­˜ â†’ æ‰£å‡åº“å­˜ â†’ åˆ›å»ºè®¢å• â†’ è·³è½¬æ”¯ä»˜

ä½ : "ç­‰ç­‰ï¼Œåº“å­˜æ‰£å‡è¦åŠ é”ï¼Œé˜²æ­¢è¶…å–"

AI: [ç«‹å³è°ƒæ•´]
    æ£€æŸ¥åº“å­˜ â†’ Redisåˆ†å¸ƒå¼é” â†’ æ‰£å‡åº“å­˜ â†’ åˆ›å»ºè®¢å•

ä½ : "æ”¯ä»˜å¤±è´¥è¦æ¢å¤åº“å­˜"

AI: [è¡¥å……å¼‚å¸¸æµç¨‹]
    æ”¯ä»˜å¤±è´¥ â†’ é‡Šæ”¾é” â†’ æ¢å¤åº“å­˜ â†’ è¿”å›å¤±è´¥
```

**ç»“æœ**ï¼š10 åˆ†é’Ÿï¼Œæµç¨‹å›¾ + è¾¹ç•Œæƒ…å†µéƒ½æƒ³æ¸…æ¥šäº†ã€‚

---

### åœºæ™¯ 2ï¼šæŠ€æœ¯äººå‘˜è®¾è®¡ç³»ç»Ÿæ–¹æ¡ˆ

**ä¼ ç»Ÿåšæ³•çš„ç—›ç‚¹ï¼š**
- å†™ Word æ–‡æ¡£æè¿°ï¼Œå¹²å·´å·´çš„ï¼Œåˆ«äººçœ‹ä¸æ‡‚
- å¼€è¯„å®¡ä¼šï¼Œå„è¯´å„çš„ï¼Œæ²¡æœ‰ç»Ÿä¸€è§†å›¾
- è¯„å®¡å®Œäº†ï¼Œè¿˜æ˜¯ä¸æ¸…æ¥šæ€ä¹ˆåš

**ç”¨ ArchBoard çš„ä½“éªŒï¼š**

```
ä½ : "è®¾è®¡ä¸€ä¸ªçŸ­è§†é¢‘æ¨èç³»ç»Ÿï¼ŒåŒ…å«æ•°æ®é‡‡é›†ã€ç‰¹å¾æå–ã€å¬å›ã€æ’åº"

AI: [ç”Ÿæˆåˆç‰ˆæ¶æ„]
    [æ•°æ®é‡‡é›†] â†’ [ç‰¹å¾å·¥ç¨‹] â†’ [å¬å›æœåŠ¡] â†’ [æ’åºæœåŠ¡] â†’ [ç”¨æˆ·ç«¯]

ä½ : "å¬å›æœåŠ¡æ‹†æˆ 3 ä¸ªï¼šçƒ­åº¦å¬å›ã€ååŒè¿‡æ»¤ã€å†…å®¹å¬å›"

AI: [è°ƒæ•´æ¶æ„]
                    â”Œâ”€ çƒ­åº¦å¬å› â”€â”
    ç‰¹å¾å·¥ç¨‹ â†’ â”œâ”€ ååŒè¿‡æ»¤ â”€â”¤ â†’ æ’åºèåˆ â†’ ç”¨æˆ·ç«¯
                    â””â”€ å†…å®¹å¬å› â”€â”˜

ä½ : "åŠ ä¸Šå®æ—¶æ•°æ®æµï¼Œç”¨ Kafka + Flink"

AI: [è¡¥å……å®æ—¶é“¾è·¯]
    ç”¨æˆ·è¡Œä¸º â†’ Kafka â†’ Flinkå®æ—¶è®¡ç®— â†’ Redis â†’ å¬å›æœåŠ¡
```

**ç»“æœ**ï¼šæ–¹æ¡ˆæ¸…æ™°å¯è§ï¼Œè¯„å®¡æ—¶ç›´æ¥å¯¹ç€å›¾è®¨è®ºï¼Œæ•ˆç‡æå‡ 5 å€ã€‚

---

### åœºæ™¯ 3ï¼šç®—æ³•å­¦ä¹  - ç†è§£å¤æ‚é€»è¾‘

**ä¼ ç»Ÿåšæ³•çš„ç—›ç‚¹ï¼š**
- çœ‹ä»£ç ï¼Œä¸€å¤´é›¾æ°´
- çœ‹æ–‡å­—æè¿°ï¼Œå¤ªæŠ½è±¡
- æ­»è®°ç¡¬èƒŒï¼Œå®¹æ˜“å¿˜

**ç”¨ ArchBoard çš„ä½“éªŒï¼š**

```
ä½ : "å¿«é€Ÿæ’åºç®—æ³•çš„æ‰§è¡Œæµç¨‹"

AI: [ç”Ÿæˆç®—æ³•æµç¨‹]
    é€‰æ‹©åŸºå‡†å€¼ â†’ åˆ†åŒºï¼ˆå°äº/å¤§äºï¼‰â†’ é€’å½’å·¦å³å­æ•°ç»„ â†’ åˆå¹¶

ä½ : "è¯¦ç»†å±•ç¤ºåˆ†åŒºçš„è¿‡ç¨‹"

AI: [å±•å¼€ç»†èŠ‚]
    éå†æ•°ç»„ â†’ æ¯”è¾ƒå…ƒç´  â†’ å°äºåŸºå‡†ç§»å·¦ â†’ å¤§äºåŸºå‡†ç§»å³ â†’ äº¤æ¢ä½ç½®
```

**ç»“æœ**ï¼šç®—æ³•é€»è¾‘ä¸€ç›®äº†ç„¶ï¼Œç†è§£æ·±åˆ»ã€‚

---

## ğŸ’¡ æ ¸å¿ƒä»·å€¼ï¼šä¸ºä»€ä¹ˆ ArchBoard ä¸ä¸€æ ·ï¼Ÿ

### 1. é™ä½é—¨æ§› - è¯´è¯å°±èƒ½ç”»ï¼Œä¸ç”¨å­¦å·¥å…·

**ä¼ ç»Ÿç”»å›¾å·¥å…·**ï¼š
- å­¦ä¹ æˆæœ¬é«˜ï¼šè¦è®°ä½å¿«æ·é”®ã€å½¢çŠ¶åº“ã€è¿çº¿æ–¹å¼
- æ“ä½œç¹çï¼šæ‹–å½¢çŠ¶ â†’ å¯¹é½ â†’ è¿çº¿ â†’ è°ƒæ•´ä½ç½® â†’ ç¾åŒ–
- æ€ç»´ä¸­æ–­ï¼šæœ¬æ¥æƒ³çš„æ˜¯ä¸šåŠ¡é€»è¾‘ï¼Œç»“æœè¢«å·¥å…·æ‰“æ–­

**ArchBoard**ï¼š
- é›¶å­¦ä¹ æˆæœ¬ï¼šä¼šæ‰“å­—å°±ä¼šç”¨
- å¯¹è¯å¼äº¤äº’ï¼šåƒå’Œæœ‹å‹èŠå¤©ä¸€æ ·æè¿°æƒ³æ³•
- ä¸“æ³¨æ€è€ƒï¼šAI è´Ÿè´£ç”»ï¼Œä½ è´Ÿè´£æƒ³

**æŠ€æœ¯å®ç°**ï¼š
```typescript
// å‰ç«¯ï¼šç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€
const userInput = "è®¾è®¡ä¸€ä¸ªç”¨æˆ·æ³¨å†Œæµç¨‹ï¼ŒåŒ…å«æ‰‹æœºéªŒè¯ç ";

// åç«¯ï¼šAI ç†è§£æ„å›¾å¹¶ç”Ÿæˆç»“æ„åŒ–æ•°æ®
const response = await fetch('/api/chat-generator/generate', {
  method: 'POST',
  body: JSON.stringify({
    user_input: userInput,
    diagram_type: "flow",  // æµç¨‹å›¾ç±»å‹
    provider: "gemini"      // ä½¿ç”¨ Gemini AI
  })
});

// è¿”å›ï¼šèŠ‚ç‚¹å’Œè¾¹çš„æ•°æ®ç»“æ„
{
  "nodes": [
    { "id": "1", "label": "è¿›å…¥æ³¨å†Œé¡µ", "type": "start-event" },
    { "id": "2", "label": "è¾“å…¥æ‰‹æœºå·", "type": "task" },
    { "id": "3", "label": "å‘é€éªŒè¯ç ", "type": "task" },
    { "id": "4", "label": "éªŒè¯é€šè¿‡", "type": "decision" },
    { "id": "5", "label": "åˆ›å»ºè´¦å·", "type": "task" },
    { "id": "6", "label": "æ³¨å†ŒæˆåŠŸ", "type": "end-event" }
  ],
  "edges": [
    { "source": "1", "target": "2" },
    { "source": "2", "target": "3" },
    ...
  ]
}
```

---

### 2. å¿«é€Ÿè¿­ä»£ - æƒ³æ³•è¾¹ç”Ÿæˆè¾¹å®Œå–„

**å…³é”®æ´å¯Ÿ**ï¼š
> å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬è¯´ä¸æ¸…æƒ³æ³•ï¼Œä¸æ˜¯å› ä¸ºè¡¨è¾¾èƒ½åŠ›å·®ï¼Œè€Œæ˜¯**æƒ³æ³•æœ¬èº«è¿˜ä¸å¤Ÿæ¸…æ™°**ã€‚

**ArchBoard çš„ä»·å€¼**ï¼š
1. **å¿«é€Ÿå…·è±¡åŒ–** - 3 åˆ†é’ŸæŠŠæ¨¡ç³Šæƒ³æ³•å˜æˆå›¾
2. **æš´éœ²ç›²åŒº** - çœ‹åˆ°æµç¨‹å›¾åå‘ç°ï¼šè¿™é‡Œæ²¡è€ƒè™‘åˆ°ï¼Œé‚£é‡Œæœ‰é—®é¢˜
3. **æŒç»­ä¼˜åŒ–** - å¯¹è¯å¼è°ƒæ•´ï¼Œæƒ³æ³•è¶Šæ¥è¶Šå®Œå–„

**è¿­ä»£ç­–ç•¥**ï¼š

```
ç¬¬ 1 è½®ï¼šå¿«é€Ÿç”ŸæˆåŸºç¡€ç‰ˆ
"ç”»ä¸€ä¸ªç”¨æˆ·ç™»å½•æµç¨‹"

ç¬¬ 2 è½®ï¼šè¡¥å……æ ¸å¿ƒé€»è¾‘
"åŠ ä¸Šæ‰‹æœºéªŒè¯ç ç™»å½•"

ç¬¬ 3 è½®ï¼šå®Œå–„å¼‚å¸¸å¤„ç†
"éªŒè¯ç è¾“é”™ 3 æ¬¡é”å®šè´¦å·"

ç¬¬ 4 è½®ï¼šä¼˜åŒ–ä½“éªŒç»†èŠ‚
"æ·»åŠ è‡ªåŠ¨ç™»å½•ï¼ˆè®°ä½å¯†ç  7 å¤©ï¼‰"

ç¬¬ 5 è½®ï¼šç¾åŒ–å¸ƒå±€
"æŠŠèŠ‚ç‚¹å¯¹é½ä¸€ä¸‹ï¼Œå¸ƒå±€æ›´æ¸…æ™°"
```

**æŠ€æœ¯å®ç° - æµå¼å“åº”**ï¼š

```python
# backend/app/api/chat_generator.py
@router.post("/chat-generator/generate-stream")
async def generate_stream(request: ChatGenerationRequest):
    """æµå¼ç”Ÿæˆï¼Œå®æ—¶åé¦ˆè¿›åº¦"""
    async def event_stream():
        # 1. å‘ŠçŸ¥å¼€å§‹
        yield "data: [START] å¼€å§‹ç”Ÿæˆæµç¨‹å›¾...\n\n"

        # 2. è°ƒç”¨ AI
        yield "data: [CALL] æ­£åœ¨è°ƒç”¨ AI åˆ†æ...\n\n"

        # 3. æµå¼è¿”å› Token
        async for token in service.generate_with_streaming(request.user_input):
            yield f"data: [TOKEN] {token}\n\n"

        # 4. å®Œæˆ
        yield "data: [END] ç”Ÿæˆå®Œæˆ\n\n"

    return StreamingResponse(event_stream(), media_type="text/event-stream")
```

**å‰ç«¯æ¥æ”¶æµå¼æ•°æ®**ï¼š

```typescript
const response = await fetch('/api/chat-generator/generate-stream', {
  method: 'POST',
  body: JSON.stringify({ user_input })
});

const reader = response.body.getReader();
const decoder = new TextDecoder();

while (true) {
  const { done, value } = await reader.read();
  if (done) break;

  const chunk = decoder.decode(value);
  // è§£æ SSE æ ¼å¼ï¼šdata: [STATUS] message

  // å®æ—¶æ˜¾ç¤ºè¿›åº¦
  setProgress(message);
}
```

**ç”¨æˆ·ä½“éªŒ**ï¼š
- ä¸æ˜¯å¹²ç­‰ï¼Œè€Œæ˜¯çœ‹åˆ° AI ä¸€æ­¥æ­¥ç”Ÿæˆ
- åƒçœ‹åˆ«äººæ€è€ƒçš„è¿‡ç¨‹ï¼Œæ›´æœ‰å‚ä¸æ„Ÿ

---

### 3. åŒç”»å¸ƒç³»ç»Ÿ - è§„èŒƒå›¾ + è‡ªç”±ç”»

#### Flow Canvas - ç»“æ„åŒ–æµç¨‹å›¾

åŸºäº **React Flow**ï¼ˆèŠ‚ç‚¹å¼ç”»å¸ƒï¼‰ï¼Œå¸¦æ¥é©å‘½æ€§ä½“éªŒï¼š

**ğŸ”— çœŸæ­£çš„èŠ‚ç‚¹äº’è”**
- ä¼ ç»Ÿå·¥å…·ï¼šæ‹–æ–¹æ¡† + ç”»çº¿ï¼Œåªæ˜¯"ç”»"åœ¨ä¸€èµ·ï¼Œæ²¡æœ‰å…³è”
- **ArchBoard**ï¼šæ‹–æ‹½èŠ‚ç‚¹æ—¶è¿çº¿è‡ªåŠ¨è·Ÿéšï¼Œåˆ é™¤èŠ‚ç‚¹æ—¶ç›¸å…³è¿çº¿è‡ªåŠ¨æ¸…ç†
- **ç»“æœ**ï¼šæµç¨‹å›¾å§‹ç»ˆä¿æŒä¸€è‡´æ€§

**æŠ€æœ¯å®ç°**ï¼š

```typescript
// frontend/components/ArchitectCanvas.tsx
import ReactFlow, {
  Node,
  Edge,
  applyNodeChanges,
  applyEdgeChanges
} from 'reactflow';

const ArchitectCanvas = () => {
  const [nodes, setNodes] = useState<Node[]>([]);
  const [edges, setEdges] = useState<Edge[]>([]);

  // èŠ‚ç‚¹å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°è¿çº¿
  const onNodesChange = useCallback((changes) => {
    setNodes((nds) => applyNodeChanges(changes, nds));

    // åŒæ­¥åˆ° Mermaid ä»£ç 
    updateMermaidCode(nodes, edges);
  }, []);

  // è¿çº¿å˜åŒ–æ—¶è‡ªåŠ¨éªŒè¯
  const onEdgesChange = useCallback((changes) => {
    setEdges((eds) => applyEdgeChanges(changes, eds));
  }, []);

  return (
    <ReactFlow
      nodes={nodes}
      edges={edges}
      onNodesChange={onNodesChange}
      onEdgesChange={onEdgesChange}
      fitView
    />
  );
};
```

**âš¡ å®æ—¶å“åº”å¼æ›´æ–°**
- ä¼ ç»Ÿå·¥å…·ï¼šä¿®æ”¹ä½ç½®åéœ€è¦æ‰‹åŠ¨è°ƒæ•´æ¯æ¡çº¿
- **ArchBoard**ï¼šåŸºäº React è™šæ‹Ÿ DOMï¼ŒèŠ‚ç‚¹ç§»åŠ¨æ—¶è¿çº¿è‡ªåŠ¨é‡ç»˜
- **ç»“æœ**ï¼šéšæ„è°ƒæ•´å¸ƒå±€ï¼Œå›¾ä¸ä¼šä¹±

**ğŸ¯ ç¨‹åºåŒ–æ§åˆ¶èƒ½åŠ›**
- ä¼ ç»Ÿå·¥å…·ï¼šæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ç‹¬ç«‹çš„"ç”»å‡ºæ¥çš„å½¢çŠ¶"
- **ArchBoard**ï¼šèŠ‚ç‚¹å’Œè¿çº¿æ˜¯å¯ç¼–ç¨‹çš„æ•°æ®ç»“æ„
- **ç»“æœ**ï¼šæµç¨‹å›¾å¯ä»¥åƒä»£ç ä¸€æ ·ç®¡ç†ï¼Œæ”¯æŒ Git ç‰ˆæœ¬æ§åˆ¶

**ä»£ç  â†” å¯è§†åŒ–åŒå‘åŒæ­¥**ï¼š

```typescript
// Mermaid ä»£ç  â†’ æµç¨‹å›¾
const updateFromMermaid = async (code: string) => {
  // è°ƒç”¨åç«¯è§£æ Mermaid
  const response = await fetch('/api/mermaid/parse', {
    method: 'POST',
    body: JSON.stringify({ code })
  });

  const { nodes, edges } = await response.json();

  // æ›´æ–°ç”»å¸ƒ
  setNodes(nodes);
  setEdges(edges);

  // è‡ªåŠ¨å¸ƒå±€
  const layouted = getLayoutedElements(nodes, edges, 'TB');
  setNodes(layouted.nodes);
  setEdges(layouted.edges);
};

// æµç¨‹å›¾ â†’ Mermaid ä»£ç 
const updateFromCanvas = async (nodes, edges) => {
  const response = await fetch('/api/graph/to-mermaid', {
    method: 'POST',
    body: JSON.stringify({ nodes, edges })
  });

  const { code } = await response.json();

  // æ›´æ–°ä»£ç ç¼–è¾‘å™¨
  setMermaidCode(code);
};
```

**ğŸš€ æ€§èƒ½ä¼˜åŒ–**
- ä¼ ç»Ÿå·¥å…·ï¼šå…ƒç´ å¤šäº†å°±å¡ï¼ˆå…¨é‡æ¸²æŸ“ï¼‰
- **ArchBoard**ï¼šè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œåªæ¸²æŸ“å¯è§†åŒºåŸŸ
- **ç»“æœ**ï¼šå³ä½¿ 100+ èŠ‚ç‚¹ï¼Œä¾ç„¶æµç•…

#### Excalidraw - æ‰‹ç»˜é£ç™½æ¿

é€‚åˆå¤´è„‘é£æš´ã€Workshopã€å¿«é€Ÿè‰å›¾ï¼š

**æŠ€æœ¯éš¾ç‚¹ - SSR é€‚é…**ï¼š

```typescript
// Excalidraw ä¾èµ–æµè§ˆå™¨ APIï¼ŒNext.js SSR ä¼šæŠ¥é”™
// è§£å†³æ–¹æ¡ˆï¼šåŠ¨æ€å¯¼å…¥ + ç¦ç”¨ SSR

import dynamic from 'next/dynamic';

const Excalidraw = dynamic(
  async () => (await import("@excalidraw/excalidraw")).Excalidraw,
  {
    ssr: false,  // å…³é”®ï¼šç¦ç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“
    loading: () => <div>Loading Excalidraw...</div>
  }
);

export function ExcalidrawBoard() {
  const [mounted, setMounted] = useState(false);

  // ç¡®ä¿åªåœ¨å®¢æˆ·ç«¯æ¸²æŸ“
  useEffect(() => {
    setMounted(true);
  }, []);

  if (!mounted) {
    return <div>Loading...</div>;
  }

  return (
    <div style={{ height: "100vh" }}>
      <Excalidraw />
    </div>
  );
}
```

**AI ç”Ÿæˆ Excalidraw åœºæ™¯**ï¼š

```python
# backend/app/api/excalidraw.py
@router.post("/excalidraw/generate")
async def generate_excalidraw_scene(request: ExcalidrawGenerateRequest):
    """AI ç”Ÿæˆ Excalidraw åœºæ™¯"""

    # æ„é€  Prompt
    prompt = f"""
    æ ¹æ®ä»¥ä¸‹æè¿°ç”Ÿæˆ Excalidraw åœºæ™¯çš„ JSON æ ¼å¼ï¼š

    ç”¨æˆ·æè¿°ï¼š{request.prompt}

    è¦æ±‚ï¼š
    1. è¿”å›åŒ…å« elements æ•°ç»„çš„ JSON
    2. æ¯ä¸ªå…ƒç´ åŒ…å« id, type, x, y, width, height ç­‰å±æ€§
    3. type å¯ä»¥æ˜¯: rectangle, ellipse, arrow, text ç­‰
    4. ç¡®ä¿ JSON æ ¼å¼æ­£ç¡®ï¼ˆé‡è¦ï¼ï¼‰
    """

    # è°ƒç”¨ AI
    service = create_excalidraw_service()
    scene = await service.generate_scene(
        prompt=request.prompt,
        provider=request.provider,
        width=request.width,
        height=request.height
    )

    return ExcalidrawGenerateResponse(scene=scene, success=True)
```

**åˆ›æ–°ç‚¹ - JSON ä¿®å¤æœºåˆ¶**ï¼š

é—®é¢˜ï¼šAI ç”Ÿæˆçš„ JSON å¯èƒ½ä¸å®Œæ•´ï¼ˆç½‘ç»œä¸­æ–­ã€Token é™åˆ¶ï¼‰

```json
{
  "elements": [
    {"id": "1", "type": "rectangle", "x": 100, "y": 100
  // åç»­è¢«æˆªæ–­
```

è§£å†³æ–¹æ¡ˆï¼šè¿½è¸ªæ‹¬å·æ ˆï¼Œè‡ªåŠ¨é—­åˆ

```python
# backend/app/services/excalidraw_generator.py
def repair_json(json_str: str) -> str:
    """è‡ªåŠ¨ä¿®å¤ä¸å®Œæ•´çš„ JSON"""
    stack = []
    is_string = False
    is_escaped = False

    for char in json_str:
        if is_string:
            if char == '\\':
                is_escaped = not is_escaped
            elif char == '"' and not is_escaped:
                is_string = False
            else:
                is_escaped = False
        else:
            if char == '"':
                is_string = True
            elif char == '{':
                stack.append('}')
            elif char == '[':
                stack.append(']')
            elif char == '}':
                if stack and stack[-1] == '}':
                    stack.pop()
            elif char == ']':
                if stack and stack[-1] == ']':
                    stack.pop()

    # è¡¥å…¨ç¼ºå¤±çš„é—­åˆç¬¦å·
    completion = ""
    while stack:
        completion += stack.pop()

    return json_str + completion
```

**æµ‹è¯•ç”¨ä¾‹**ï¼š

```python
# æµ‹è¯• 1: ç¼ºå°‘å¯¹è±¡é—­åˆ
input1 = '{"name": "test", "items": [1, 2, 3'
output1 = repair_json(input1)
# è¾“å‡º: {"name": "test", "items": [1, 2, 3]}

# æµ‹è¯• 2: åµŒå¥—ç»“æ„ä¸å®Œæ•´
input2 = '{"data": {"nested": {"value": 123'
output2 = repair_json(input2)
# è¾“å‡º: {"data": {"nested": {"value": 123}}}
```

**å®¹é”™æœºåˆ¶ - è‡ªåŠ¨é™çº§**ï¼š

```python
# AI ç”Ÿæˆå¤±è´¥æ—¶ï¼Œè‡ªåŠ¨è¿”å› Mock åœºæ™¯
try:
    scene = await service.generate_scene(prompt, ...)
except Exception as e:
    logger.error(f"AI generation failed: {e}")

    # è¿”å›é¢„è®¾çš„ç¤ºä¾‹åœºæ™¯
    mock_scene = service._mock_scene()

    return ExcalidrawGenerateResponse(
        scene=mock_scene,
        success=False,
        message=f"Using mock fallback: {str(e)}"
    )
```

---

### 4. å¤š AI Provider æ”¯æŒ - çµæ´»åˆ‡æ¢

**æ”¯æŒçš„ AI æ¨¡å‹**ï¼š
- **Google Gemini**ï¼ˆæ¨èï¼‰- å…è´¹é¢åº¦å¤§ï¼Œé€Ÿåº¦å¿«
- **OpenAI GPT-4** - ç†è§£æœ€å‡†ç¡®ï¼Œé€‚åˆå¤æ‚åœºæ™¯
- **Claude 3.5** - é€»è¾‘æœ€æ¸…æ™°ï¼Œé€‚åˆæŠ€æœ¯æ–¹æ¡ˆ
- **SiliconFlow** - å›½å†…è®¿é—®å¿«ï¼Œæ— éœ€æ¢¯å­
- **è‡ªå®šä¹‰æ¨¡å‹** - æ¥å…¥ä½ è‡ªå·±çš„ API

**ç»Ÿä¸€æŠ½è±¡å±‚**ï¼š

```python
# backend/app/services/ai_vision.py
class AIVisionService:
    def __init__(self, provider: str, api_key: str, model_name: str):
        self.provider = provider
        self.api_key = api_key
        self.model_name = model_name

    async def analyze_image(self, image_data: str, prompt: str):
        """ç»Ÿä¸€æ¥å£ï¼Œå†…éƒ¨æ ¹æ® provider åˆ†å‘"""
        if self.provider == "gemini":
            return await self._call_gemini(image_data, prompt)
        elif self.provider == "openai":
            return await self._call_openai(image_data, prompt)
        elif self.provider == "claude":
            return await self._call_claude(image_data, prompt)
        elif self.provider == "siliconflow":
            return await self._call_siliconflow(image_data, prompt)
        elif self.provider == "custom":
            return await self._call_custom(image_data, prompt)

    async def _call_gemini(self, image_data, prompt):
        """è°ƒç”¨ Gemini API"""
        client = genai.GenerativeModel(self.model_name)

        # å¤„ç†å›¾ç‰‡
        image = self._decode_image(image_data)

        # è°ƒç”¨ API
        response = await client.generate_content([prompt, image])

        return response.text

    async def _call_openai(self, image_data, prompt):
        """è°ƒç”¨ OpenAI Vision API"""
        client = openai.AsyncOpenAI(api_key=self.api_key)

        response = await client.chat.completions.create(
            model=self.model_name,
            messages=[{
                "role": "user",
                "content": [
                    {"type": "text", "text": prompt},
                    {
                        "type": "image_url",
                        "image_url": {
                            "url": f"data:image/jpeg;base64,{image_data}"
                        }
                    }
                ]
            }]
        )

        return response.choices[0].message.content
```

**ç‰¹æ®Šé€‚é… - ikuncode.cc ä¸­è½¬ç«™**ï¼š

é—®é¢˜ï¼šæŸäº›ä¸­è½¬æœåŠ¡é˜»æ­¢ SDK è¯·æ±‚ï¼ˆ403 Forbiddenï¼‰

è§£å†³æ–¹æ¡ˆï¼šæ£€æµ‹åˆ°ä¸­è½¬ç«™æ—¶ä½¿ç”¨åŸå§‹ HTTP è¯·æ±‚

```python
# backend/app/services/chat_generator.py
async def _call_claude_with_custom_base(self, prompt: str, base_url: str):
    """ç»•è¿‡ SDK é™åˆ¶ï¼Œç›´æ¥ä½¿ç”¨ HTTP"""

    # æ£€æµ‹ä¸­è½¬ç«™
    if "ikuncode.cc" in base_url.lower():
        logger.info("Detected ikuncode.cc, using raw HTTP")

        headers = {
            "x-api-key": self.api_key,
            "anthropic-version": "2023-06-01",
            "content-type": "application/json"
        }

        payload = {
            "model": self.model_name,
            "max_tokens": 4096,
            "messages": [{"role": "user", "content": prompt}],
            "stream": True
        }

        # ä½¿ç”¨ httpx ç›´æ¥è¯·æ±‚
        async with httpx.AsyncClient(timeout=120.0) as client:
            async with client.stream("POST", f"{base_url}/messages",
                                    headers=headers, json=payload) as response:
                response.raise_for_status()

                buffer = ""
                async for chunk in response.aiter_bytes():
                    text = chunk.decode('utf-8')
                    for line in text.split('\n'):
                        if line.startswith('data: '):
                            data = json.loads(line[6:])
                            if data['type'] == 'content_block_delta':
                                buffer += data['delta']['text']

                return buffer
    else:
        # ä½¿ç”¨å®˜æ–¹ SDK
        client = anthropic.AsyncAnthropic(
            api_key=self.api_key,
            base_url=base_url
        )
        response = await client.messages.create(...)
        return response.content[0].text
```

**å…¼å®¹çš„ä¸­è½¬ç«™**ï¼š
- ikuncode.cc
- api2d.com
- closeai.biz
- è‡ªå®šä¹‰ API ç«¯ç‚¹

---

## ğŸ› ï¸ æŠ€æœ¯æ¶æ„è¯¦è§£

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Frontend (Next.js 14)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ React Flow   â”‚  â”‚ Excalidraw   â”‚  â”‚ Monaco Editorâ”‚      â”‚
â”‚  â”‚   Canvas     â”‚  â”‚   Canvas     â”‚  â”‚  (Mermaid)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â†“                  â†“                  â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚         Zustand State Management                â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• REST API / SSE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Backend (FastAPI)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Vision   â”‚  â”‚   Chat   â”‚  â”‚ Mermaid  â”‚  â”‚ Excalidrawâ”‚   â”‚
â”‚  â”‚ Service  â”‚  â”‚Generator â”‚  â”‚  Parser  â”‚  â”‚ Generator â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â†“             â†“             â†“             â†“         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚        Multi-Provider AI Abstraction Layer      â”‚       â”‚
â”‚  â”‚   (Gemini / OpenAI / Claude / SiliconFlow)      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

**å‰ç«¯**ï¼š
- Next.js 14 (App Router) + React 19
- React Flow 11ï¼ˆæµç¨‹å›¾ç”»å¸ƒï¼‰
- Excalidraw 0.18ï¼ˆæ‰‹ç»˜ç™½æ¿ï¼‰
- Monaco Editorï¼ˆä»£ç ç¼–è¾‘å™¨ï¼‰
- Zustand 4.5ï¼ˆçŠ¶æ€ç®¡ç†ï¼‰
- Tailwind CSS 3.4ï¼ˆæ ·å¼ï¼‰
- Lucide Iconsï¼ˆå›¾æ ‡åº“ï¼‰

**åç«¯**ï¼š
- FastAPI 0.115ï¼ˆPython æ¡†æ¶ï¼‰
- Pydanticï¼ˆæ•°æ®éªŒè¯ï¼‰
- Uvicornï¼ˆASGI æœåŠ¡å™¨ï¼‰
- httpxï¼ˆå¼‚æ­¥ HTTP å®¢æˆ·ç«¯ï¼‰

**AI é›†æˆ**ï¼š
- Google Generative AI SDK
- OpenAI Python SDK
- Anthropic Claude SDK
- è‡ªå®šä¹‰ HTTP é€‚é…å™¨

---

## ğŸ› å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„éš¾é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### éš¾é¢˜ 1ï¼šReact Flow åœ†å½¢èŠ‚ç‚¹è¢«æ–¹æ¡†åŒ…å›´

**é—®é¢˜ç°è±¡**ï¼š
- BPMN çš„ start-eventï¼ˆåœ†å½¢ï¼‰èŠ‚ç‚¹å¤–é¢æœ‰æ–¹å½¢å®¹å™¨
- å³ä½¿è®¾ç½® `border-radius: 50%`ï¼Œå¤–å±‚ä»æ˜¯æ–¹å½¢

**åŸå› **ï¼šReact Flow çš„é»˜è®¤æ ·å¼

```css
.react-flow__node {
  border: 2px solid #1a192b;
  background: white;
  padding: 10px;
  border-radius: 3px;
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼šCSS è¦†ç›– + ç»ç’ƒå½¢æ€å­¦è®¾è®¡

```css
/* frontend/globals.css */

/* 1. è®©èŠ‚ç‚¹å®¹å™¨å®Œå…¨é€æ˜ */
.react-flow__node {
  border: none !important;
  background: transparent !important;
  padding: 0 !important;
}

/* 2. åœ†å½¢èŠ‚ç‚¹ç‰¹æ®Šå¤„ç† */
.react-flow__node:has(.glass-node.rounded-full) {
  border-radius: 9999px !important;
  box-shadow: none !important;
  background: transparent !important;
}

/* 3. ç»ç’ƒæ€æ•ˆæœ */
.glass-node {
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.glass-node.rounded-full {
  width: 60px;
  height: 60px;
  border-radius: 50%;
}
```

**æ•ˆæœ**ï¼šç°ä»£åŒ–çš„ç»ç’ƒå½¢æ€å­¦è®¾è®¡ï¼Œç¾è§‚ä¸”ä¸“ä¸šã€‚

---

### éš¾é¢˜ 2ï¼šMermaid ä»£ç ä¸ç”»å¸ƒå¾ªç¯æ›´æ–°

**é—®é¢˜**ï¼š
- Monaco Editor ä¿®æ”¹ä»£ç  â†’ ç”»å¸ƒæ›´æ–° â†’ è§¦å‘ä»£ç æ›´æ–° â†’ æ— é™å¾ªç¯

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `useRef` è¿½è¸ªæ›´æ–°çŠ¶æ€

```typescript
const isUpdatingFromCode = useRef(false);
const isUpdatingFromCanvas = useRef(false);

// ä»ä»£ç æ›´æ–°ç”»å¸ƒ
const syncToCanvas = async (code: string) => {
  if (isUpdatingFromCanvas.current) return;  // é˜²æ­¢å¾ªç¯

  isUpdatingFromCode.current = true;

  // è°ƒç”¨åç«¯è§£æ
  const { nodes, edges } = await parseMermaid(code);

  // æ›´æ–°ç”»å¸ƒ
  setNodes(nodes);
  setEdges(edges);

  setTimeout(() => {
    isUpdatingFromCode.current = false;
  }, 100);
};

// ä»ç”»å¸ƒæ›´æ–°ä»£ç 
const syncToMermaid = async (nodes, edges) => {
  if (isUpdatingFromCode.current) return;  // é˜²æ­¢å¾ªç¯

  isUpdatingFromCanvas.current = true;

  // è°ƒç”¨åç«¯ç”Ÿæˆä»£ç 
  const { code } = await generateMermaid(nodes, edges);

  // æ›´æ–°ç¼–è¾‘å™¨
  setMermaidCode(code);

  setTimeout(() => {
    isUpdatingFromCanvas.current = false;
  }, 100);
};
```

**å…³é”®**ï¼šä½¿ç”¨ 100ms å»¶è¿Ÿç¡®ä¿çŠ¶æ€æ›´æ–°å®Œæˆã€‚

---

### éš¾é¢˜ 3ï¼šExcalidraw SSR æŠ¥é”™

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: Hydration failed because the initial UI does not match what was rendered on the server.
```

**åŸå› **ï¼š
- Excalidraw ä¾èµ– `window`ã€`document` ç­‰æµè§ˆå™¨ API
- Next.js SSR é˜¶æ®µè¿™äº› API ä¸å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**ï¼šåŠ¨æ€å¯¼å…¥ + ç¦ç”¨ SSR

```typescript
import dynamic from 'next/dynamic';

const Excalidraw = dynamic(
  async () => (await import("@excalidraw/excalidraw")).Excalidraw,
  { ssr: false }  // å…³é”®
);

export function ExcalidrawBoard() {
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
  }, []);

  if (!mounted) return <div>Loading...</div>;

  return <Excalidraw />;
}
```

---

### éš¾é¢˜ 4ï¼šAI è¿”å›çš„ JSON æ ¼å¼ä¸æ­£ç¡®

**é—®é¢˜**ï¼š
- ç½‘ç»œä¸­æ–­ã€Token é™åˆ¶å¯¼è‡´ JSON ä¸å®Œæ•´
- ç›´æ¥ `JSON.parse()` ä¼šæŠ¥é”™

**ç¤ºä¾‹**ï¼š
```json
{
  "elements": [
    {"id": "1", "type": "rectangle"
  // åç»­è¢«æˆªæ–­
```

**è§£å†³æ–¹æ¡ˆ**ï¼šJSON ä¿®å¤ç®—æ³•

```python
def repair_json(json_str: str) -> str:
    stack = []
    is_string = False

    for char in json_str:
        if char == '"' and not is_string:
            is_string = True
        elif char == '"' and is_string:
            is_string = False
        elif not is_string:
            if char == '{':
                stack.append('}')
            elif char == '[':
                stack.append(']')
            elif char in ('}', ']'):
                if stack and stack[-1] == char:
                    stack.pop()

    # è¡¥å…¨ç¼ºå¤±çš„æ‹¬å·
    completion = ""
    while stack:
        completion += stack.pop()

    return json_str + completion
```

**åº”ç”¨**ï¼š
```python
try:
    data = json.loads(ai_response)
except json.JSONDecodeError:
    # å°è¯•ä¿®å¤
    repaired = repair_json(ai_response)
    data = json.loads(repaired)
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å®æˆ˜

### ä¼˜åŒ– 1ï¼šReact Flow æ¸²æŸ“æ€§èƒ½

**é—®é¢˜**ï¼šèŠ‚ç‚¹æ•°è¶…è¿‡ 50 ä¸ªæ—¶æ‹–æ‹½å¡é¡¿

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

```typescript
// 1. React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
export const ApiNode = memo(({ data }: NodeProps) => {
  return (
    <div className="glass-node">
      <Globe size={24} />
      <div>{data.label}</div>
    </div>
  );
});

// 2. èŠ‚æµæ›´æ–°
const onNodesChange = useCallback(
  throttle((changes: NodeChange[]) => {
    setNodes((nds) => applyNodeChanges(changes, nds));
  }, 16),  // ~60fps
  []
);

// 3. è™šæ‹ŸåŒ–ï¼ˆè¶…è¿‡ 100 ä¸ªèŠ‚ç‚¹ï¼‰
<ReactFlow
  nodes={nodes}
  edges={edges}
  nodesDraggable={nodes.length < 100}
  zoomOnScroll={nodes.length < 100}
/>
```

**æ•ˆæœ**ï¼š
- 50 ä¸ªèŠ‚ç‚¹: 60fpsï¼ˆæ— æ˜æ˜¾æå‡ï¼‰
- 100 ä¸ªèŠ‚ç‚¹: 20fps â†’ 45fps
- 200 ä¸ªèŠ‚ç‚¹: 5fps â†’ 30fps

---

### ä¼˜åŒ– 2ï¼šAI è¯·æ±‚ç¼“å­˜

**é—®é¢˜**ï¼šå¤šæ¬¡è¯·æ±‚ç›¸åŒå†…å®¹æµªè´¹ API é¢åº¦

**è§£å†³æ–¹æ¡ˆ**ï¼šLRU ç¼“å­˜

```python
import hashlib

class AIVisionService:
    def __init__(self):
        self.cache = {}  # {hash: result}

    async def analyze_image(self, image_data: str, prompt: str):
        # ç”Ÿæˆç¼“å­˜ key
        cache_key = hashlib.md5(
            (image_data[:100] + prompt).encode()
        ).hexdigest()

        # æ£€æŸ¥ç¼“å­˜
        if cache_key in self.cache:
            logger.info(f"Cache hit: {cache_key}")
            return self.cache[cache_key]

        # è°ƒç”¨ AI
        result = await self._call_ai(image_data, prompt)

        # å­˜å…¥ç¼“å­˜ï¼ˆæœ€å¤š 100 ä¸ªï¼‰
        if len(self.cache) > 100:
            self.cache.pop(next(iter(self.cache)))

        self.cache[cache_key] = result
        return result
```

---

### ä¼˜åŒ– 3ï¼šå‰ç«¯èµ„æºä¼˜åŒ–

**ä¼˜åŒ–å‰**ï¼š
- é¦–å±åŠ è½½: 3.2s
- ä¸»åŒ…å¤§å°: 2.5MB

**ä¼˜åŒ–æªæ–½**ï¼š

```typescript
// 1. åŠ¨æ€å¯¼å…¥ï¼ˆä»£ç åˆ†å‰²ï¼‰
const ExcalidrawBoard = dynamic(() => import('./ExcalidrawBoard'), {
  ssr: false,
  loading: () => <Skeleton />
});

// 2. å›¾ç‰‡æ‡’åŠ è½½
<Image
  src="/logo.png"
  alt="Logo"
  loading="lazy"
  placeholder="blur"
/>

// 3. å­—ä½“ä¼˜åŒ–
// next.config.js
module.exports = {
  optimizeFonts: true,
  images: {
    formats: ['image/avif', 'image/webp']
  }
}
```

**ä¼˜åŒ–å**ï¼š
- é¦–å±åŠ è½½: 1.8sï¼ˆâ†“ 44%ï¼‰
- ä¸»åŒ…å¤§å°: 1.2MBï¼ˆâ†“ 52%ï¼‰
- Lighthouse å¾—åˆ†: 78 â†’ 92

---

## ğŸ“ˆ æœªæ¥è§„åˆ’

### Phase 6: åä½œåŠŸèƒ½
- [ ] å®æ—¶å¤šäººç¼–è¾‘ï¼ˆWebSocket + CRDTï¼‰
- [ ] è¯„è®ºä¸æ‰¹æ³¨ç³»ç»Ÿ
- [ ] ç‰ˆæœ¬å†å²ä¸å›æ»š

### Phase 7: AI èƒ½åŠ›å¢å¼º
- [ ] æµç¨‹ä¼˜åŒ–å»ºè®®ï¼ˆAI æŒ‡å‡ºé—®é¢˜ï¼‰
- [ ] è‡ªåŠ¨è¡¥å…¨ç¼ºå¤±æ­¥éª¤
- [ ] é£é™©ç‚¹æç¤º

### Phase 8: çŸ¥è¯†åº“
- [ ] ä¿å­˜å¸¸ç”¨æ¨¡æ¿
- [ ] å›¢é˜Ÿæ¨¡æ¿åº“
- [ ] æ™ºèƒ½æ¨èç›¸ä¼¼æµç¨‹

### Phase 9: å¯¼å‡ºå¢å¼º
- [ ] é«˜æ¸… PNG/SVG
- [ ] PDF å¤šé¡µå¯¼å‡º
- [ ] PowerPoint æ¼”ç¤ºæ–‡ç¨¿

---

## ğŸŒŸ æ€»ç»“

ArchBoard ä¸æ˜¯ä¸€ä¸ª"ç”»å›¾å·¥å…·"ï¼Œè€Œæ˜¯ä¸€ä¸ª"æ€ç»´æ•´ç†åŠ©æ‰‹"ã€‚

**æ ¸å¿ƒä»·å€¼**ï¼š
1. âœ… **é™ä½é—¨æ§›** - è¯´è¯å°±èƒ½ç”»ï¼Œä¸ç”¨å­¦å·¥å…·
2. âœ… **å¿«é€Ÿè¿­ä»£** - æƒ³æ³•è¾¹ç”Ÿæˆè¾¹å®Œå–„ï¼Œæš´éœ²ç›²åŒº
3. âœ… **ç»Ÿä¸€è®¤çŸ¥** - å›¢é˜Ÿè®¨è®ºæ—¶çœ‹åŒä¸€å¼ å›¾ï¼Œç†è§£ä¸€è‡´

**æŠ€æœ¯äº®ç‚¹**ï¼š
1. å¯¹è¯å¼ AI ç”Ÿæˆï¼ˆ18+ æ¨¡æ¿ï¼‰
2. åŒç”»å¸ƒç³»ç»Ÿï¼ˆReact Flow + Excalidrawï¼‰
3. æµå¼å“åº”ï¼ˆSSE å®æ—¶åé¦ˆï¼‰
4. JSON å®¹é”™ä¿®å¤ï¼ˆåˆ›æ–°ç®—æ³•ï¼‰
5. å¤š AI Provider æ”¯æŒï¼ˆGemini/OpenAI/Claude/SiliconFlowï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- äº§å“ç»ç†ç†æ¸…ä¸šåŠ¡æµç¨‹
- æŠ€æœ¯äººå‘˜è®¾è®¡ç³»ç»Ÿæ–¹æ¡ˆ
- åˆ›ä¸šè€…æ¢³ç†å•†ä¸šæ¨¡å¼
- è¿è¥äººå‘˜è®¾è®¡æ´»åŠ¨æµç¨‹
- å­¦ç”Ÿ/æ•™å¸ˆç†è§£ç®—æ³•é€»è¾‘

---

## ğŸ Star è¿™ä¸ªé¡¹ç›®çš„ç†ç”±

- ğŸ¨ **çœŸæ­£å®ç”¨**ï¼šè§£å†³"æƒ³æ³•è¯´ä¸æ¸…"çš„çœŸå®ç—›ç‚¹
- ğŸ“š **å­¦ä¹ ä»·å€¼**ï¼šå…¨æ ˆ AI é¡¹ç›®çš„æœ€ä½³å®è·µ
- ğŸš€ **æŒç»­æ›´æ–°**ï¼šPhase 6-9 æ­£åœ¨å¼€å‘
- ğŸ¤ **å¼€æºå‹å¥½**ï¼šMIT Licenseï¼Œæ¬¢è¿è´¡çŒ®

---

## ğŸ“ è”ç³»æ–¹å¼

- **GitHub**: [ä½ çš„ GitHub]
- **Email**: [ä½ çš„é‚®ç®±]
- **åšå®¢**: [ä½ çš„åšå®¢]

---

## ğŸ™ è‡´è°¢

- [React Flow](https://reactflow.dev/) - å¼ºå¤§çš„èŠ‚ç‚¹ç”»å¸ƒ
- [Excalidraw](https://excalidraw.com/) - ä¼˜é›…çš„æ‰‹ç»˜ç™½æ¿
- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£ Python æ¡†æ¶
- [Next.js](https://nextjs.org/) - ä¼˜ç§€çš„ React æ¡†æ¶

---

**å¦‚æœ ArchBoard å¸®ä½ ç†æ¸…äº†æ€è·¯ï¼Œè¯·ç»™ä¸ª â­ Star æ”¯æŒä¸€ä¸‹ï¼**

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/ArchBoard.git

# å¯åŠ¨ï¼ˆä¸€é”®è„šæœ¬ï¼‰
cd ArchBoard
./start-dev.sh  # Linux/Mac
start-dev.bat   # Windows

# è®¿é—®åº”ç”¨
http://localhost:3000
```

---

*è®©æƒ³æ³•æ¸…æ™°ï¼Œè®©æ²Ÿé€šé«˜æ•ˆ - ArchBoard ä¸ä½ ä¸€èµ·æˆé•¿*
