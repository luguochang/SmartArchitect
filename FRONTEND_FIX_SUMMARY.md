# å‰ç«¯å’Œåç«¯ä¿®å¤å®Œæ•´æ€»ç»“

## ğŸ” é—®é¢˜åˆ†æ

### 1. å‰ç«¯é—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰âœ…
**é—®é¢˜**ï¼šFlowchartUploader.tsx æ²¡æœ‰ä¼ é€’ `fast_mode` å‚æ•°
- **ä½ç½®**ï¼šç¬¬ 50 è¡Œ
- **åŸä»£ç **ï¼šåªä¼ äº† `preserve_layout`
- **ä¿®å¤**ï¼šæ·»åŠ  `formData.append("fast_mode", "true")`

### 2. ç”¨æˆ·ä½“éªŒé—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰âœ…
**é—®é¢˜**ï¼š43 ç§’ç­‰å¾…æ—¶é—´æ— ä»»ä½•åé¦ˆ
- **ä¿®å¤**ï¼šæ·»åŠ é˜¶æ®µæ€§è¿›åº¦æç¤º
  - 10s: ğŸ” æ­£åœ¨åˆ†æå›¾ç‰‡ç»“æ„...
  - 20s: ğŸ“Š æ­£åœ¨è¯†åˆ«èŠ‚ç‚¹å’Œè¿çº¿...
  - 30s: âš™ï¸ æ­£åœ¨ç”Ÿæˆæµç¨‹å›¾æ•°æ®...
  - 40s: âœ¨ å³å°†å®Œæˆ...
- **ä¿®å¤**ï¼šä¸Šä¼ åŒºåŸŸæ˜¾ç¤º "é¢„è®¡éœ€è¦ 40-60 ç§’"

### 3. åç«¯ä¼˜åŒ–ï¼ˆå·²å®Œæˆï¼‰âœ…
æ‰€æœ‰ä¼˜åŒ–å·²å®ç°ï¼š
- âœ… ç®€åŒ– Promptï¼ˆ30 è¡Œï¼‰
- âœ… detail="low" å‚æ•°
- âœ… max_retries=0
- âœ… max_tokens=1500
- âœ… timeout=240s

---

## âš ï¸ å½“å‰çŠ¶æ€

**æµ‹è¯•ç»“æœ**ï¼šä»ç„¶è¶…æ—¶ï¼ˆ90ç§’ï¼‰

**å¯èƒ½åŸå› **ï¼š
1. Python ç¼“å­˜äº†æ—§çš„ `.pyc` æ–‡ä»¶
2. åç«¯è¿›ç¨‹æ²¡æœ‰å®Œå…¨é‡å¯
3. ç¯å¢ƒå˜é‡æˆ–æ¨¡å—æœªé‡æ–°åŠ è½½

---

## ğŸ”§ å®Œæ•´é‡å¯æ­¥éª¤

### æ–¹æ¡ˆ 1ï¼šæ¸…é™¤ç¼“å­˜å¹¶é‡å¯ï¼ˆæ¨èï¼‰

```bash
# 1. åœæ­¢åç«¯ï¼ˆCtrl+Cï¼‰

# 2. æ¸…é™¤ Python ç¼“å­˜
cd backend
find . -type d -name __pycache__ -exec rm -rf {} + 2>nul
del /s /q *.pyc 2>nul

# 3. é‡æ–°å¯åŠ¨
python -m app.main
```

### æ–¹æ¡ˆ 2ï¼šå¼ºåˆ¶é‡æ–°åŠ è½½æ¨¡å—

```bash
# ä½¿ç”¨ --reload å‚æ•°ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
cd backend
python -m app.main --reload
```

### æ–¹æ¡ˆ 3ï¼šæ£€æŸ¥ç¯å¢ƒ

```bash
# ç¡®è®¤ä½¿ç”¨çš„ Python ç‰ˆæœ¬
python --version

# ç¡®è®¤ä¾èµ–å·²å®‰è£…
pip list | findstr openai
```

---

## ğŸ“Š éªŒè¯æ­¥éª¤

### 1. å¯åŠ¨åç«¯åï¼Œæ£€æŸ¥æ—¥å¿—

åç«¯å¯åŠ¨æ—¶åº”è¯¥æ˜¾ç¤ºï¼š
```
INFO:     SiliconFlow client initialized with base_url: https://api.siliconflow.cn/v1
```

### 2. è¿è¡Œè¯Šæ–­è„šæœ¬

```bash
python test_check_backend_logs.py
```

æŸ¥çœ‹åç«¯æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
[FLOWCHART API] Analyzing with siliconflow, ... fast_mode=True, ...
[SILICONFLOW] Starting vision analysis ... detail=low, timeout=240s
```

### 3. è¿è¡Œå®Œæ•´æµ‹è¯•

```bash
python test_frontend_simulation.py
```

**é¢„æœŸç»“æœ**ï¼š40-50 ç§’æˆåŠŸ âœ…

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### å‰ç«¯
- âœ… `frontend/components/FlowchartUploader.tsx`
  - ç¬¬ 51 è¡Œï¼šæ·»åŠ  `fast_mode` å‚æ•°
  - ç¬¬ 64-72 è¡Œï¼šæ·»åŠ è¿›åº¦æç¤º
  - ç¬¬ 204-206 è¡Œï¼šæ˜¾ç¤ºé¢„è®¡ç­‰å¾…æ—¶é—´

### åç«¯
- âœ… `backend/app/services/ai_vision.py`
  - ç¬¬ 241-283 è¡Œï¼šç®€åŒ–ç‰ˆ prompt
  - ç¬¬ 285-453 è¡Œï¼šè¯¦ç»†ç‰ˆ prompt
  - ç¬¬ 455-468 è¡Œï¼šåŒå±‚ prompt é€‰æ‹©
  - ç¬¬ 520 è¡Œï¼šmax_tokens = 1500
  - ç¬¬ 526 è¡Œï¼šdetail = "low"
  - ç¬¬ 116 è¡Œï¼šmax_retries = 0
  - ç¬¬ 115 è¡Œï¼štimeout = 240.0
  - ç¬¬ 678 è¡Œï¼šè·å– detail å‚æ•°
  - ç¬¬ 697 è¡Œï¼šä¼ é€’ detail åˆ° image_url

- âœ… `backend/app/api/vision.py`
  - ç¬¬ 161 è¡Œï¼šæ·»åŠ  fast_mode å‚æ•°
  - ç¬¬ 268 è¡Œï¼šä¼ é€’ fast_mode ç»™ service

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

ä¿®å¤åçš„å®Œæ•´æµç¨‹ï¼š

1. **ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡**
2. **å‰ç«¯æ˜¾ç¤º**ï¼š"é¢„è®¡éœ€è¦ 40-60 ç§’"
3. **è¿›åº¦æç¤º**ï¼šæ¯ 10 ç§’æ›´æ–°ä¸€æ¬¡çŠ¶æ€
4. **åç«¯å¤„ç†**ï¼š
   - ä½¿ç”¨ç®€åŒ– promptï¼ˆ30 è¡Œï¼‰
   - detail="low"ï¼ˆä½åˆ†è¾¨ç‡å¿«é€Ÿå¤„ç†ï¼‰
   - max_tokens=1500
   - ç¦ç”¨é‡è¯•
5. **40-50 ç§’åè¿”å›ç»“æœ** âœ…

---

## ğŸ› å¦‚æœä»ç„¶è¶…æ—¶

æ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

1. **åç«¯æ—¥å¿—æ˜¯å¦æ˜¾ç¤º**ï¼š
   ```
   [SILICONFLOW] ... detail=low, timeout=240s
   ```
   - âŒ å¦‚æœæ²¡æœ‰ â†’ åç«¯æœªåŠ è½½æœ€æ–°ä»£ç 
   - âœ… å¦‚æœæœ‰ â†’ ç»§ç»­ä¸‹ä¸€æ­¥

2. **API è°ƒç”¨æ˜¯å¦åŒ…å« fast_mode**ï¼š
   ```
   [FLOWCHART API] ... fast_mode=True
   ```
   - âŒ å¦‚æœæ˜¯ False â†’ å‰ç«¯æœªæ›´æ–°
   - âœ… å¦‚æœæ˜¯ True â†’ ç»§ç»­ä¸‹ä¸€æ­¥

3. **æ£€æŸ¥ OpenAI client åˆå§‹åŒ–**ï¼š
   åç«¯å¯åŠ¨æ—¥å¿—åº”æ˜¾ç¤ºï¼š
   ```
   SiliconFlow client initialized with base_url: https://api.siliconflow.cn/v1
   ```

4. **æ£€æŸ¥æ¨¡å‹åç§°**ï¼š
   ç¡®è®¤ä½¿ç”¨çš„æ˜¯ `Qwen/Qwen3-VL-32B-Thinking` è€Œä¸æ˜¯å…¶ä»–æ¨¡å‹

---

## ğŸ’¡ ä¸´æ—¶æ›¿ä»£æ–¹æ¡ˆ

å¦‚æœä¼˜åŒ–åä»ç„¶è¾ƒæ…¢ï¼Œå¯ä»¥è€ƒè™‘ï¼š

### æ–¹æ¡ˆ Aï¼šåˆ‡æ¢åˆ°æ›´å¿«çš„æ¨¡å‹
```python
# ä½¿ç”¨ Qwen2.5-VL-7Bï¼ˆæ›´å¿«ä½†å‡†ç¡®ç‡ç•¥ä½ï¼‰
model_name = "Qwen/Qwen2.5-VL-7B-Instruct"
```

### æ–¹æ¡ˆ Bï¼šä½¿ç”¨ Geminiï¼ˆé€šå¸¸æ›´å¿«ï¼‰
```python
# å‰ç«¯åˆ‡æ¢ provider
provider = "gemini"
```

### æ–¹æ¡ˆ Cï¼šé™ä½ max_tokens
```python
# è¿›ä¸€æ­¥é™ä½
max_tokens = 1000 if fast_mode else 4096
```

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨è¿è¡Œæµ‹è¯•å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] åç«¯å·²å®Œå…¨åœæ­¢ï¼ˆCtrl+Cï¼‰
- [ ] å·²æ¸…é™¤ __pycache__ ç›®å½•
- [ ] å·²åˆ é™¤ *.pyc æ–‡ä»¶
- [ ] åç«¯é‡æ–°å¯åŠ¨
- [ ] åç«¯æ—¥å¿—æ˜¾ç¤º SiliconFlow client initialized
- [ ] å‰ç«¯ä»£ç å·²ä¿å­˜ï¼ˆFlowchartUploader.tsxï¼‰
- [ ] æµè§ˆå™¨å·²åˆ·æ–°ï¼ˆCtrl+F5 å¼ºåˆ¶åˆ·æ–°ï¼‰

---

**ä¸‹ä¸€æ­¥**ï¼šè¯·æŒ‰ç…§"å®Œæ•´é‡å¯æ­¥éª¤"é‡å¯åç«¯ï¼Œç„¶åè¿è¡Œ `python test_frontend_simulation.py` éªŒè¯ã€‚
